CREATE OR REPLACE PROCEDURE
  `cartodb-on-gcp-datascience.workflows_temp.wfproc_99f4a862fab79f80`(
)
BEGIN
  /*
   {"versionId":"311b1afcf38302ab","paramsId":"97d170e1550eee4a","isImmutable":false,"diagramJson":"{\"title\":\"(2/) GeoPython25 - Unlocking Smarter Property Risk Assessments with Spatio-Temporal Crime Insights and CARTO\",\"description\":\"\",\"nodes\":[{\"id\":\"28b547c5-40f2-45d2-baef-4d39353fbf73\",\"data\":{\"name\":\"Note\",\"color\":\"#8BE0A4\",\"genAi\":false,\"label\":\"\",\"width\":447.998,\"height\":447.994,\"inputs\":[],\"markdown\":\"---\\nlabel:\\n---\\n## Input data\\n\\nHere we take the data enriched with ACS and CARTO spatial features data and reduce their dimensionality by applying the Factorial Analysis of Mixed Data (FAMD) which generalizes the use of PCA to account for the number of modalities available to each categorical/ordinal variable and on the probabilities of these modalities.\\n\\nThis method is implemented in the [BUILD_PCAMIX_DATA](https://docs.carto.com/data-and-analysis/analytics-toolbox-for-bigquery/sql-reference/statistics#build_pcamix_data) and [BUILD_PCAMIX_MODEL](https://docs.carto.com/data-and-analysis/analytics-toolbox-for-bigquery/sql-reference/statistics#build_pcamix_model) procedures in CARTO Analytics Toolbox for BigQuery.\",\"position\":{\"x\":-352,\"y\":352}},\"type\":\"note\",\"width\":448,\"height\":448,\"zIndex\":-1,\"dragging\":false,\"position\":{\"x\":-896,\"y\":352},\"selected\":false,\"positionAbsolute\":{\"x\":-896,\"y\":352}},{\"id\":\"52ba816c-b12f-4b0e-a3fe-62b35e2a42bb\",\"data\":{\"name\":\"native.selectexpression\",\"label\":\"Create Column\",\"inputs\":[{\"name\":\"source\",\"type\":\"Table\",\"title\":\"Source table\",\"description\":\"Source table\"},{\"name\":\"column\",\"type\":\"String\",\"title\":\"Name for new column\",\"placeholder\":\"E.g.: distance_in_meters\",\"validation\":\"^[a-zA-Z_][a-zA-Z0-9_]*$\",\"allowExpressions\":false,\"description\":\"Name for new column\",\"value\":\"uuid\"},{\"name\":\"expression\",\"type\":\"StringSql\",\"title\":\"Expression\",\"placeholder\":\"E.g.: distance_in_km * 1000\",\"description\":\"Expression\",\"value\":\"CONCAT(h3, '_', acs_year)\"},{\"name\":\"optimizationcol\",\"value\":\"h3\"}],\"version\":\"1\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":-144,\"y\":416},\"selected\":false,\"positionAbsolute\":{\"x\":-144,\"y\":416}},{\"id\":\"10e7ba75-f9ac-411c-a500-96f7b328cda8\",\"data\":{\"name\":\"native.call\",\"label\":\"Call Procedure\",\"title\":\"BUILD_PCAMIX_DATA\",\"inputs\":[{\"name\":\"sourcea\",\"type\":\"Table\",\"title\":\"Source table\",\"optional\":true,\"description\":\"Source table\"},{\"name\":\"sourceb\",\"type\":\"Table\",\"title\":\"Source table\",\"optional\":true,\"description\":\"Source table\"},{\"name\":\"sql\",\"type\":\"StringSql\",\"title\":\"SQL CALL statement\",\"mode\":\"multiline\",\"placeholder\":\"CALL MY_PROCEDURE($a, 10, $output);\",\"allowExpressions\":false,\"description\":\"SQL CALL statement\",\"value\":\"DROP TABLE IF EXISTS `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`;\\n\\nCALL `carto-un`.carto.BUILD_PCAMIX_DATA(\\n  '''SELECT * FROM `$a`''',\\n'uuid',\\n['median_age_avg',\\n'median_rent_avg',\\n'black_pop_sum',\\n'hispanic_pop_sum',\\n'owner_occupied_housing_units_median_value_sum',\\n'vacant_housing_units_sum',\\n'housing_units_sum',\\n'families_with_young_children_sum'],\\nNULL,\\n['urbanity_any_ordinal'],\\n'<my-project>.<my-dataset>.CHI_boundary_pca',\\n'''{\\n\\\"ordinal_encoding\\\":\\\"CATEGORICAL\\\"\\n'''\\n)\"},{\"name\":\"optimizationcol\"}],\"version\":\"2.0.0\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":192,\"y\":576},\"selected\":false,\"positionAbsolute\":{\"x\":192,\"y\":576}},{\"id\":\"770c3148-08c0-46da-bb63-e11446a12e41\",\"data\":{\"name\":\"native.call\",\"label\":\"Call Procedure\",\"title\":\"BUILD_PCAMIX_MODEL\",\"inputs\":[{\"name\":\"sourcea\",\"type\":\"Table\",\"title\":\"Source table\",\"optional\":true,\"description\":\"Source table\"},{\"name\":\"sourceb\",\"type\":\"Table\",\"title\":\"Source table\",\"optional\":true,\"description\":\"Source table\"},{\"name\":\"sql\",\"type\":\"StringSql\",\"title\":\"SQL CALL statement\",\"mode\":\"multiline\",\"placeholder\":\"CALL MY_PROCEDURE($a, 10, $output);\",\"allowExpressions\":false,\"description\":\"SQL CALL statement\",\"value\":\"CALL `carto-un`.carto.BUILD_PCAMIX_MODEL(\\n'''SELECT * FROM `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`''',\\n'uuid',\\n'<my-project>.<my-dataset>.CHI_boundary_pca_model',\\n'''{\\n\\\"NUM_PRINCIPAL_COMPONENTS\\\":2}'''\\n);\\n\\nCALL `carto-un`.carto.PREDICT_PCAMIX_SCORES(\\n'''SELECT * FROM `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`''',\\n'uiid',\\n'<my-project>.<my-dataset>.CHI_boundary_pca_model',\\n'<my-project>.<my-dataset>.CHI_boundary_pca_scores'\\n)\"},{\"name\":\"optimizationcol\"}],\"version\":\"2.0.0\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":416,\"y\":624},\"selected\":false,\"positionAbsolute\":{\"x\":416,\"y\":592}},{\"id\":\"c89d8cac-62d0-4162-91f6-329e513f16b7\",\"data\":{\"name\":\"native.customsql\",\"label\":\"Custom SQL Select\",\"title\":\"CUSTOM JOIN\",\"inputs\":[{\"name\":\"sourcea\",\"type\":\"Table\",\"title\":\"Source table a\",\"optional\":true,\"description\":\"Source table a\"},{\"name\":\"sourceb\",\"type\":\"Table\",\"title\":\"Source table b\",\"optional\":true,\"description\":\"Source table b\"},{\"name\":\"sourcec\",\"type\":\"Table\",\"title\":\"Source table c\",\"optional\":true,\"description\":\"Source table c\"},{\"name\":\"sql\",\"type\":\"StringSql\",\"title\":\"SQL SELECT statement\",\"mode\":\"multiline\",\"placeholder\":\"SELECT ST_Centroid(geom) AS geom,\\n  AVG(value) AS average_value,\\n  category\\nFROM $a\\nGROUP BY category\",\"allowExpressions\":false,\"description\":\"SQL SELECT statement\",\"value\":\"SELECT a.* EXCEPT(uuid), b.principal_component_1,\\nb.principal_component_2\\nFROM `$a` a\\nJOIN `<my-project>.<my-dataset>.CHI_boundary_pca_scores` b\\nUSING(uuid)\"},{\"name\":\"optimizationcol\"}],\"version\":\"2.0.0\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":592,\"y\":432},\"selected\":false,\"positionAbsolute\":{\"x\":592,\"y\":432}},{\"id\":\"a553cc74-f720-4681-9ba9-70739f50567d\",\"data\":{\"name\":\"native.saveastable\",\"label\":\"Save as Table\",\"inputs\":[{\"name\":\"source\",\"type\":\"Table\",\"title\":\"Source table\",\"description\":\"Source table\"},{\"name\":\"destination\",\"type\":\"OutputTable\",\"title\":\"Table details\",\"placeholder\":\"Rename and select destination\",\"description\":\"Table details\",\"value\":\"<my-project>.<my-dataset>.CHI_boundary_enriched_w_ACS_2007_2020_w_pc_scores\"},{\"name\":\"append\",\"type\":\"Boolean\",\"title\":\"Append to existing table\",\"default\":false,\"description\":\"Append to existing table\",\"value\":false},{\"name\":\"optimizationcol\",\"type\":\"Column\",\"title\":\"Cluster by\",\"parent\":\"source\",\"dataType\":[\"geography\",\"boolean\",\"number\",\"string\",\"date\",\"datetime\",\"time\",\"timestamp\"],\"providers\":[\"bigquery\"],\"optional\":true,\"advanced\":true,\"description\":\"Cluster by\",\"value\":\"h3\"}],\"version\":\"1\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":816,\"y\":560},\"selected\":false,\"positionAbsolute\":{\"x\":864,\"y\":640}},{\"id\":\"28b547c5-40f2-45d2-baef-4d39353fbf73-1726152355183\",\"data\":{\"name\":\"Note\",\"color\":\"#F89C74\",\"genAi\":false,\"label\":\"\",\"width\":1104,\"height\":447.994,\"inputs\":[],\"markdown\":\"---\\nlabel:\\n---\\n## FAMD\\n\",\"position\":{\"x\":128,\"y\":352}},\"type\":\"note\",\"width\":1104,\"height\":448,\"zIndex\":-1,\"dragging\":false,\"position\":{\"x\":-416,\"y\":352},\"selected\":false,\"positionAbsolute\":{\"x\":-416,\"y\":352}},{\"id\":\"28b547c5-40f2-45d2-baef-4d39353fbf73-1726152355183-1726152367517\",\"data\":{\"name\":\"Note\",\"color\":\"#FE88B1\",\"genAi\":false,\"label\":\"\",\"width\":223.998,\"height\":447.998,\"inputs\":[],\"markdown\":\"---\\nlabel:\\n---\\n## Save results to a table\\n\",\"position\":{\"x\":720,\"y\":352}},\"type\":\"note\",\"width\":480,\"height\":448,\"zIndex\":-1,\"dragging\":true,\"position\":{\"x\":720,\"y\":352},\"selected\":false,\"positionAbsolute\":{\"x\":720,\"y\":352}},{\"id\":\"8220cbc3-7f1f-45be-9e04-198a206fa4fe\",\"data\":{\"name\":\"native.casewhen\",\"label\":\"Case When\",\"inputs\":[{\"name\":\"source\",\"type\":\"Table\",\"title\":\"Source table\",\"description\":\"Source table\"},{\"name\":\"conditions\",\"type\":\"Condition\",\"parent\":\"source\",\"title\":\"Conditions and returns\",\"placeholder\":\"workflows.parameterForm.selectAColumn\",\"description\":\"Conditions and returns\",\"value\":\"[{\\\"column\\\":\\\"urbanity_any\\\",\\\"conditions\\\":[{\\\"condition\\\":\\\"=\\\",\\\"value\\\":\\\"Low_density_urban\\\",\\\"return\\\":\\\"1\\\"},{\\\"condition\\\":\\\"=\\\",\\\"value\\\":\\\"Medium_density_urban\\\",\\\"return\\\":\\\"2\\\"},{\\\"condition\\\":\\\"=\\\",\\\"value\\\":\\\"High_density_urban\\\",\\\"return\\\":\\\"3\\\"},{\\\"condition\\\":\\\"=\\\",\\\"value\\\":\\\"Very_High_density_urban\\\",\\\"return\\\":\\\"4\\\"}]}]\"},{\"name\":\"else\",\"type\":\"String\",\"title\":\"Else\",\"placeholder\":\"workflows.parameterForm.returnValue\",\"optional\":true,\"helper\":\"workflows.parameterForm.elseHelper\",\"allowExpressions\":false,\"description\":\"Else\",\"value\":\"0\"},{\"name\":\"newcolumn\",\"type\":\"String\",\"title\":\"Name for new column\",\"placeholder\":\"workflows.parameterForm.returnColumn\",\"trimSpaces\":true,\"default\":\"new_column\",\"allowExpressions\":false,\"description\":\"Name for new column\",\"value\":\"urbanity_any_ordinal\"},{\"name\":\"optimizationcol\",\"value\":\"h3\"}],\"version\":\"2\"},\"type\":\"generic\",\"width\":64,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":-320,\"y\":416},\"selected\":false,\"positionAbsolute\":{\"x\":-320,\"y\":416}},{\"id\":\"28b547c5-40f2-45d2-baef-4d39353fbf73-1726152355183-1727087849244\",\"data\":{\"name\":\"Note\",\"color\":\"#F89C74\",\"genAi\":false,\"label\":\"\",\"width\":720,\"height\":239.994,\"inputs\":[],\"markdown\":\"---\\nlabel: Data preparation\\n---\\n- Numerical variables: standard scale the columns to get their z-scores\\n- Categorical variables:\\n  - One-hot-encode the categorical columns to get their indicator matrix\\n  - Weight each column by the inverse of the square root of its probability, given by the number of ones in each column (Ns) divided by the number of observations (N)\\n  - Center the columns\\n\\n\",\"position\":{\"x\":-400,\"y\":543.998}},\"type\":\"note\",\"width\":720,\"height\":240,\"zIndex\":-1,\"dragging\":false,\"position\":{\"x\":-400,\"y\":544},\"selected\":false,\"positionAbsolute\":{\"x\":-400,\"y\":544}},{\"id\":\"28b547c5-40f2-45d2-baef-4d39353fbf73-1726152355183-1727087849244-1727087964751\",\"data\":{\"name\":\"Note\",\"color\":\"#F89C74\",\"genAi\":false,\"label\":\"\",\"width\":240,\"height\":239.998,\"inputs\":[],\"markdown\":\"---\\nlabel: Run FAMD\\n---\\n\",\"position\":{\"x\":336,\"y\":544}},\"type\":\"note\",\"width\":240,\"height\":240,\"zIndex\":-1,\"dragging\":false,\"position\":{\"x\":336,\"y\":544},\"selected\":false,\"positionAbsolute\":{\"x\":336,\"y\":544}},{\"id\":\"bd9981c2-e1ad-48c9-aa82-70f4a6f6360a\",\"data\":{\"id\":\"cartobq.sdsc24_ny_workshops.CHI_boundary_enriched_w_ACS_2007_2020\",\"name\":\"ReadTable\",\"size\":137234,\"type\":\"table\",\"label\":\"CHI_boundary_enriched_w_ACS_2007_2020\",\"nrows\":1160,\"inputs\":[{\"name\":\"source\",\"type\":\"String\",\"title\":\"Source table\",\"value\":\"cartobq.sdsc24_ny_workshops.CHI_boundary_enriched_w_ACS_2007_2020\",\"description\":\"Read Table\"}],\"schema\":[{\"name\":\"h3\",\"type\":\"string\"},{\"name\":\"total_pop_sum\",\"type\":\"number\"},{\"name\":\"median_age_avg\",\"type\":\"number\"},{\"name\":\"median_rent_avg\",\"type\":\"number\"},{\"name\":\"black_pop_sum\",\"type\":\"number\"},{\"name\":\"hispanic_pop_sum\",\"type\":\"number\"},{\"name\":\"owner_occupied_housing_units_median_value_sum\",\"type\":\"number\"},{\"name\":\"vacant_housing_units_sum\",\"type\":\"number\"},{\"name\":\"housing_units_sum\",\"type\":\"number\"},{\"name\":\"families_with_young_children_sum\",\"type\":\"number\"},{\"name\":\"acs_year\",\"type\":\"number\"},{\"name\":\"urbanity_any\",\"type\":\"string\"}],\"enriched\":true,\"provider\":\"bigquery\",\"geomField\":\"h3:h3\",\"tableRegion\":\"US\",\"lastModified\":1728930760518,\"optimization\":{\"actions\":[{\"type\":\"cluster\",\"enabled\":false}],\"actionAvailable\":{\"msg\":\"<b>This table isn't optimized.</b> Creating a cluster based on geospatial data may improve performance.\",\"type\":\"createTable\",\"query\":\"CREATE TABLE {newTableName} CLUSTER BY h3 AS SELECT * FROM `cartobq.sdsc24_ny_workshops.CHI_boundary_enriched_w_ACS_2007_2020`\"}},\"originalSchema\":[{\"name\":\"h3\",\"type\":\"STRING\"},{\"name\":\"total_pop_sum\",\"type\":\"FLOAT\"},{\"name\":\"median_age_avg\",\"type\":\"FLOAT\"},{\"name\":\"median_rent_avg\",\"type\":\"FLOAT\"},{\"name\":\"black_pop_sum\",\"type\":\"FLOAT\"},{\"name\":\"hispanic_pop_sum\",\"type\":\"FLOAT\"},{\"name\":\"owner_occupied_housing_units_median_value_sum\",\"type\":\"FLOAT\"},{\"name\":\"vacant_housing_units_sum\",\"type\":\"FLOAT\"},{\"name\":\"housing_units_sum\",\"type\":\"FLOAT\"},{\"name\":\"families_with_young_children_sum\",\"type\":\"FLOAT\"},{\"name\":\"acs_year\",\"type\":\"INTEGER\"},{\"name\":\"urbanity_any\",\"type\":\"STRING\"}]},\"type\":\"source\",\"width\":192,\"height\":64,\"zIndex\":2,\"dragging\":false,\"position\":{\"x\":-784,\"y\":656},\"selected\":false,\"positionAbsolute\":{\"x\":-832,\"y\":672}}],\"edges\":[{\"id\":\"reactflow__edge-8220cbc3-7f1f-45be-9e04-198a206fa4feresult-52ba816c-b12f-4b0e-a3fe-62b35e2a42bbsource\",\"source\":\"8220cbc3-7f1f-45be-9e04-198a206fa4fe\",\"target\":\"52ba816c-b12f-4b0e-a3fe-62b35e2a42bb\",\"sourceHandle\":\"result\",\"targetHandle\":\"source\",\"animated\":false},{\"id\":\"reactflow__edge-52ba816c-b12f-4b0e-a3fe-62b35e2a42bbresult-10e7ba75-f9ac-411c-a500-96f7b328cda8sourcea\",\"source\":\"52ba816c-b12f-4b0e-a3fe-62b35e2a42bb\",\"target\":\"10e7ba75-f9ac-411c-a500-96f7b328cda8\",\"sourceHandle\":\"result\",\"targetHandle\":\"sourcea\",\"animated\":false},{\"id\":\"reactflow__edge-10e7ba75-f9ac-411c-a500-96f7b328cda8result-770c3148-08c0-46da-bb63-e11446a12e41sourcea\",\"source\":\"10e7ba75-f9ac-411c-a500-96f7b328cda8\",\"target\":\"770c3148-08c0-46da-bb63-e11446a12e41\",\"sourceHandle\":\"result\",\"targetHandle\":\"sourcea\",\"animated\":false},{\"id\":\"reactflow__edge-770c3148-08c0-46da-bb63-e11446a12e41result-c89d8cac-62d0-4162-91f6-329e513f16b7sourceb\",\"source\":\"770c3148-08c0-46da-bb63-e11446a12e41\",\"target\":\"c89d8cac-62d0-4162-91f6-329e513f16b7\",\"sourceHandle\":\"result\",\"targetHandle\":\"sourceb\",\"animated\":false},{\"id\":\"reactflow__edge-52ba816c-b12f-4b0e-a3fe-62b35e2a42bbresult-c89d8cac-62d0-4162-91f6-329e513f16b7sourcea\",\"source\":\"52ba816c-b12f-4b0e-a3fe-62b35e2a42bb\",\"target\":\"c89d8cac-62d0-4162-91f6-329e513f16b7\",\"sourceHandle\":\"result\",\"targetHandle\":\"sourcea\",\"animated\":false},{\"id\":\"reactflow__edge-c89d8cac-62d0-4162-91f6-329e513f16b7result-a553cc74-f720-4681-9ba9-70739f50567dsource\",\"source\":\"c89d8cac-62d0-4162-91f6-329e513f16b7\",\"target\":\"a553cc74-f720-4681-9ba9-70739f50567d\",\"sourceHandle\":\"result\",\"targetHandle\":\"source\",\"animated\":false},{\"id\":\"e9adf54e-0e9a-43f4-9c0f-b342a791ecb9\",\"source\":\"bd9981c2-e1ad-48c9-aa82-70f4a6f6360a\",\"target\":\"8220cbc3-7f1f-45be-9e04-198a206fa4fe\",\"sourceHandle\":\"out\",\"targetHandle\":\"source\",\"animated\":false}],\"variables\":null,\"procedure\":{},\"schedule\":{},\"viewport\":{\"x\":849.1126302122095,\"y\":-59.61846505499386,\"zoom\":0.8680645279479592},\"schemaVersion\":\"1.0.0\",\"connectionProvider\":\"bigquery\",\"useCache\":false}"}
  */
  BEGIN
  CREATE TEMPORARY TABLE `WORKFLOW_99f4a862fab79f80_43f0f58f228b6a8d_result`
  AS
    SELECT
      *,
      CASE
        WHEN urbanity_any = 'Low_density_urban' THEN 1
        WHEN urbanity_any = 'Medium_density_urban' THEN 2
        WHEN urbanity_any = 'High_density_urban' THEN 3
        WHEN urbanity_any = 'Very_High_density_urban' THEN 4
      ELSE 0
      END AS urbanity_any_ordinal
    FROM `cartobq.sdsc24_ny_workshops.CHI_boundary_enriched_w_ACS_2007_2020`;
  END;
  BEGIN
  CREATE TEMPORARY TABLE `WORKFLOW_99f4a862fab79f80_0e733581c7d2f8b5_result`
  AS
    SELECT *,
      CONCAT(h3, '_', acs_year) AS uuid
    FROM `WORKFLOW_99f4a862fab79f80_43f0f58f228b6a8d_result`;
  END;
  BEGIN
  DROP TABLE IF EXISTS `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`;
  CALL `carto-un`.carto.BUILD_PCAMIX_DATA(
    '''SELECT * FROM `WORKFLOW_99f4a862fab79f80_0e733581c7d2f8b5_result`''',
  'uuid',
  ['median_age_avg',
  'median_rent_avg',
  'black_pop_sum',
  'hispanic_pop_sum',
  'owner_occupied_housing_units_median_value_sum',
  'vacant_housing_units_sum',
  'housing_units_sum',
  'families_with_young_children_sum'],
  NULL,
  ['urbanity_any_ordinal'],
  '<my-project>.<my-dataset>.CHI_boundary_pca',
  '''{
  "ordinal_encoding":"CATEGORICAL"
  '''
  );
  END;
  BEGIN
  CALL `carto-un`.carto.BUILD_PCAMIX_MODEL(
  '''SELECT * FROM `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`''',
  'uuid',
  '<my-project>.<my-dataset>.CHI_boundary_pca_model',
  '''{
  "NUM_PRINCIPAL_COMPONENTS":2}'''
  );
  CALL `carto-un`.carto.PREDICT_PCAMIX_SCORES(
  '''SELECT * FROM `<my-project>.<my-dataset>.CHI_boundary_pca_model_data`''',
  'uiid',
  '<my-project>.<my-dataset>.CHI_boundary_pca_model',
  '<my-project>.<my-dataset>.CHI_boundary_pca_scores'
  );
  END;
  BEGIN
  CREATE TEMPORARY TABLE `WORKFLOW_99f4a862fab79f80_783dfa5ce86be4f6_result`
  AS
    SELECT a.* EXCEPT(uuid), b.principal_component_1,
    b.principal_component_2
    FROM `WORKFLOW_99f4a862fab79f80_0e733581c7d2f8b5_result` a
    JOIN `<my-project>.<my-dataset>.CHI_boundary_pca_scores` b
    USING(uuid);
  END;
  BEGIN
  DROP TABLE IF EXISTS `<my-project>.<my-dataset>.CHI_boundary_enriched_w_ACS_2007_2020_w_pc_scores`;
  CREATE TABLE IF NOT EXISTS `<my-project>.<my-dataset>.CHI_boundary_enriched_w_ACS_2007_2020_w_pc_scores`
  CLUSTER BY h3
  AS
    SELECT * FROM `WORKFLOW_99f4a862fab79f80_783dfa5ce86be4f6_result`;
  END;
END;